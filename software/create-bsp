#!/bin/bash

# the environment variables  PROJECT_NAME, BSP_DIR and SOPC_FILE are set by the makefile which calls this script

BSP_TYPE=hal

#modify these args as needed
NIOS2_BSP_ARGS="--set hal.max_file_descriptors 4 --set hal.enable_small_c_library true --set hal.sys_clk_timer none --set hal.timestamp_timer none --set hal.enable_exit false --set hal.enable_c_plus_plus false --set hal.enable_lightweight_device_driver_api true --set hal.enable_clean_exit false --set hal.enable_sim_optimize false --set hal.enable_reduced_device_drivers true  --set hal.make.bsp_cflags_optimization '-Os'"
CPU_NAME=


# Don't run make if create-this-app script is called with --no-make arg
SKIP_MAKE=
while [ $# -gt 0 ]
do
  case "$1" in
		--no-make)
        	SKIP_MAKE=1
        	;;
		*)
			NIOS2_BSP_ARGS="$NIOS2_BSP_ARGS $1"
			;;
  esac
  shift
done



cmd="nios2-bsp $BSP_TYPE $BSP_DIR $SOPC_FILE $NIOS2_BSP_ARGS $CPU_NAME"


echo "create-this-bsp: Running \"$cmd\""
$cmd || {
    echo "$cmd failed"
    exit 1
}
if [ -z "$SKIP_MAKE" ]; then
	echo "create-this-bsp: Running make"
	make -C ${PROJECT_NAME}_bsp
fi

